<!doctype html>
<html>
  <head><meta charset="utf-8"><title>Files</title></head>
  <body>
    <h1>Stored Files</h1>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul>
        {% for m in messages %}<li>{{ m }}</li>{% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
    <p>
      <a href="{{ url_for('upload') }}">Upload new</a> | <a href="{{ url_for('index') }}">Home</a> | <a href="{{ url_for('inbox') }}">Inbox</a>
      {% if current_user %}
        | Logged in as: <strong>{{ current_user.username }}</strong>
        | <a href="{{ url_for('logout') }}">Logout</a>
      {% endif %}
    </p>
    {% if files %}
      <table border="1" cellpadding="6">
        <tr><th>ID</th><th>Original Name</th><th>Mime</th><th>Size (bytes)</th><th>Uploaded</th><th>Actions</th></tr>
        {% for f in files %}
        <tr>
          <td>{{ f[0] }}</td>
          <td>{{ f[1] }}</td>
          <td>{{ f[3] }}</td>
          <td>{{ f[4] }}</td>
          <td>{{ f[5] }}</td>
          <td>
            {% if f[3] and f[3].startswith('image/') %}
              <a href="{{ url_for('preview', file_id=f[0]) }}" target="_blank">Preview</a> |
            {% endif %}
            <a href="{{ url_for('download', file_id=f[0]) }}">Download</a> |
            <form style="display:inline" method="post" action="{{ url_for('delete', file_id=f[0]) }}" onsubmit="return confirm('Delete file?');">
              <button type="submit">Delete</button>
            </form>
            {% if current_user and (current_user.id == f[6] or current_user.role == 'admin') %}
              <!-- Share form for owners/admin -->
              <form style="display:inline" method="post" action="{{ url_for('share_file', file_id=f[0]) }}">
                <input name="username" placeholder="share with user" />
                <input name="message" placeholder="optional message" />
                <button type="submit">Share</button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </table>
    {% else %}
      <p>No files yet.</p>
    {% endif %}
  </body>
</html>

